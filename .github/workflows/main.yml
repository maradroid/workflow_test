name: Flutter Workflow

on: [workflow_dispatch]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
          cache: true
          
      - name: Install Java
        uses: actions/setup-java@v3
        with:
          distribution: 'corretto'
          java-version: '11'
          cache: 'gradle'
          
      #- name: Get flutter version
      #  id: get_flutter_version
      # uses: its404/get-flutter-version@v1.0.0
      #- name: Output flutter version
      #  run: echo 'version_number:' ${{ steps.get_flutter_version.outputs.version_number }} ' build_number:' ${{ steps.get_flutter_version.outputs.build_number }}
          
      - name: Increment flutter build number
        uses: BentEngbers/flutter-change-version@v1.0.3
        
      #- name: Get flutter version
      #  id: get_flutter_versionn
      #  uses: its404/get-flutter-version@v1.0.0
      #- name: Output flutter version
      #  run: echo 'version_number:' ${{ steps.get_flutter_versionn.outputs.version_number }} ' build_number:' ${{ steps.get_flutter_versionn.outputs.build_number }}

      - name: Commit changes
        uses: EndBug/add-and-commit@v9
      
      - name: Install dependencies
        run: flutter pub get
        
      - name: Make a build
        run: make just_build
        
      - name: Upload to gdrive
        uses: adityak74/google-drive-upload-git-action@main
        with:
          credentials: "ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAiZ2l0aHViYWN0aW9ucy0zNzI0MTAiLAogICJwcml2YXRlX2tleV9pZCI6ICI3MTIyM2JhOWRkZGI3NWRjYTk2ZjQ2ZDQwZjg1NTA5NjgyODY4YzZhIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdlFJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLY3dnZ1NqQWdFQUFvSUJBUUNjWncwMVB4UU8xeGFIXG5ERjMzU0d1TjM3V1dSVkFZV0R5bWlweVIycWl5UUp3VytPMFY0aUJTY2l4RHNSWFg0V0RuZWc5OU5ZMVhqSlZGXG5BRFRLZ1dVUUYzUGxYQXYrK09BVnpJb0svakMrOFdQY3ZaSHRwdVpVcEJGVDFlWFZhT2w3ZHl0bEg0VW15ZXdyXG5LWm55SFJLYTk4MGVnOHhINlBQWXhrM0tBSmVwOHhZdHFFSHBEcXpiSDJLWFBYOTM3a3dhUHZCK2g0Z253Tmh1XG5VNE81NEE4aHJLa3ZWREd4Qk11S2loYklSZXdoK1BCNjhpNk1hdzhlMGtscjhIc21MUStJMytFNXFJUVp6TnpkXG43WGhHT0ZqM2dUMWMwMDRzQUpDN2JqeXRZOTllOGpCTjIrNXMyL2dEMGZZY3RMeFN1cVA2KzFwVE13d0xQZUJVXG4yWlN1ZUpqdEFnTUJBQUVDZ2dFQVJmMUpxRlBIZHBLakJxRXVwWnUzWWNCRUF2Q1dsS1piMGMxQ25uU0N2RzMwXG5TOFZ1VnpZZmI3V2ZBRlhOS0JPMzZTNHlvejNsTjlIMTlIQlFyM1J6Rk4zaDQ3Z3F1Qm1JTWNrYjF5cUVCdFovXG44VWExK0dzUk5MeE04cjdNQUpIWHRnUVFtOHFjcTh4OWpwMHB3bkpuSW9rVXRmeVYzSEl2T1FrWXczWTdhSFhuXG5rOUNnYlcycjZ2Qm5XVlpyQXZIRVB1UWdHY0hDYVVDVGVUeTRVYWI1b3YrYWM5a05HYjBpaWhnajBwSlp6UllhXG51WlBycXdNSWlPQzFLRFR2NTFIb3FKTzRWa2dEdVhYWUY3cWFlM0RVeXVTMUh4em0zZUxSSDRuSG0vblYxalc4XG44NllhU0NieDQ2NjhhYVErTkYxV21uSHQ5MU9HQjA2SjRYMHNjSlk0d3dLQmdRRFh6ZWV0T2pTcjVyM3NhSGJRXG5XWFBaMkpaYmp4U2J6RWFNek1CTkUyZXVSa1lueitHc0NnVHpyN2tCK2MwZ3VQZmNFdHRldDhzUnJmN0UzVVl6XG55SVgvWnp3ZXhIcDZ5OEUzcHBuTkVPRDR0RUVSbmUxaUl0QzAxZzVjL2FxVmNVaGwwekJreG0yZXZJWFhxYmFJXG5MaGJKZm9UY2VOdHlHTEZhMU5menpDcTZKd0tCZ1FDNWlMaFh4WUhCT2o2eEJkb282RXBoK3RoMi92R3lrMWZ1XG5oVHdSSWxVUkpmaGhjQzBzeDU4N2dlb2hRSk53NUJJckcvSFhvNllyYzcxWGFWNmd1eTVpZU9aNHg5QjArMVZLXG5vNUNZYlhHOFQvL1hvbkQ5QjF4cGFGZE9FanhKWWVYbi9ST2RRTlVIR0FIQVZxVG9Rc3RHSVQxMUFQb1VmSnhXXG5PVFdTTDdxa3l3S0JnUUNLd2dkVU45ZkVMQ0kwVHRzT2ptWFNUZFFuM1BENFdEbUlzT0o0N0tBK3kwcXlzSlMvXG5STlg0UmlXa0lwV0ZrOGt6UlNDdVgyai8zaXV4TTBHL2JCRFVydkZXS3lsQnFaOThBL0JpalpiSjgwVGZhZmRIXG5vWEVteFhnSXpNWVJQdnk1RkRqS28xZTZ1Q2NyQ3lHbG9GVGdqQ3dyZ3I0L042ZFo2djlMOEJ3TkF3S0JnQlRvXG4zYTIycXFyMlAzNS81RmhiNVpZcFNTQVFGM2xDdGRSQjI4VXFrMSs5WWNMSmU2M2lTWVhSWEd1bTlYYnhuVUtTXG5nYTBGMm9Kbkp0MmxHRzhRNldkYnJNM0w1eWhuOHZMWWdFRk5oRlh1eGl5dE9BS3NRN1AxZUhGcUNMVlVmUzZxXG5EUDNhQXFnc0FuYUV6VTBIeWhUN1JndmJzbE9BdjdYUCtNT2k4V3dGQW9HQUZPYkhuTDNsd0FFZnJjS1psVWlRXG50NXVuL2RTbVdweGJscmd6Sk5WOXdKWW9XYkcvVFIvNmhtY2c3TTdJb0RYdExna25aQnU5cXp1MmFMakhxZWp3XG5QSFFyaFRTTmFOY25FMnllSE1jM2tXVkNFUEczWVozdXIwbFhXQUlqOFQ5enpwK1d0YTdTQ0kzY1pmTEtOY21sXG5aZFNWbUFCVkpUK0V0cmppUDVUSUMvMD1cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJtdGVzdC05NzZAZ2l0aHViYWN0aW9ucy0zNzI0MTAuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLAogICJjbGllbnRfaWQiOiAiMTA1ODI3NDM0MjAwOTg1NzMwMDg4IiwKICAiYXV0aF91cmkiOiAiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tL28vb2F1dGgyL2F1dGgiLAogICJ0b2tlbl91cmkiOiAiaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW4iLAogICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwKICAiY2xpZW50X3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vcm9ib3QvdjEvbWV0YWRhdGEveDUwOS9tdGVzdC05NzYlNDBnaXRodWJhY3Rpb25zLTM3MjQxMC5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIKfQo="
          filename: build/app/outputs/flutter-apk/app-release.apk
          folderId: "1xZcWfKWSoZF2x5a4kv5MDJ7hMhl9-A0l"
          name: "new_build.apk" # optional string
          overwrite: "true" # optional boolean
